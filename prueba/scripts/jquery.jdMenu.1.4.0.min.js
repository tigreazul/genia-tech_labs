$(function(){$('ul.jd_menu').jdMenu()});(function($){$.jdMenu={settings:[],getSettings:function(a){var t=$(a).parents('ul.jd_menu:eq(0)')[0];return this.settings[t&&t.$jdSettings?t.$jdSettings:0]}};function activateMenu(a){var a=$(a);var b=a.parent();a.trigger('jdMenuShow').positionBy({target:b[0],targetPos:(b.parent().is('.jd_menu')?3:1),elementPos:0});b.addClass('jdm_active').siblings('li').find('ul:eq(0):visible').each(function(){hideMenu(this)})}function hideMenu(a){$(a).filter(':not(.jd_menu)').find('> li ul:eq(0):visible').each(function(){hideMenu(this)}).end().hide().trigger('jdMenuHide').parents('li:eq(0)').removeClass('jdm_active jdm_hover').end().find('> li').removeClass('jdm_active jdm_hover')}function getSettings(a){return $.data($(a).is('.jd_menu')?a:$(a).parents('ul.jd_menu')[0],'jdMenuSettings')}$.fn.jdMenu=function(f){var f=$.extend({activateDelay:500,showDelay:450,hideDelay:1000},f);return this.filter('ul.jd_menu').each(function(){$.data(this,'jdMenuSettings',f);$('li',this).bind('mouseenter.jdmenu',function(){$(this).addClass('jdm_hover');var a=$('ul:eq(0)',this);if(a.length==1){var b=this;clearTimeout(this.$jdTimer);this.$jdTimer=setTimeout(function(){activateMenu(a)},getSettings(this).showDelay)}}).bind('mouseleave.jdmenu',function(){$(this).removeClass('jdm_hover');var a=$('ul:eq(0)',this);if(a.length==1){var b=$.jdMenu.getSettings(this);var c=this;clearTimeout(this.$jdTimer);this.$jdTimer=setTimeout(function(){hideMenu(a)},getSettings(this).hideDelay)}}).bind('click.jdmenu',function(b){var c=$('> ul',this);if(c.length==1){activateMenu(c)}if(b.target==this){var d=$('> a',b.target).not('.accessible');if(d.length>0){var a=d[0];if(!a.onclick){window.open(a.href,a.target||'_self')}else{$(a).trigger('click')}}}$(this).parent().jdMenuHide();b.stopPropagation()}).bind('keydown.jdmenu',function(e){if(e.which==27){if(!$(this).parent().is('.jd_menu')){hideMenu($(this).parent()[0])}$(this).parents('li:eq(0)').find('a:eq(0)').trigger('focus');return false}}).find('> a').bind('focus.jdmenu',function(){$(this).parents('li:eq(0)').addClass('jdm_hover')}).bind('blur.jdmenu',function(){$(this).parents('li:eq(0)').removeClass('jdm_hover')}).filter('.accessible').bind('click.jdmenu',function(a){a.preventDefault()})})};$.fn.jdMenuUnbind=function(){$('li',this).unbind('mouseenter.jdmenu mouseleave.jdmenu click.jdmenu keydown.jdmenu').find('> a').unbind('focus.jdmenu blur.jdmenu click.jdmenu');return this};$.fn.jdMenuHide=function(){return this.filter('ul').each(function(){hideMenu(this)})};$(window).bind('click.jdmenu',function(){$('ul.jd_menu ul:visible').jdMenuHide()})})(jQuery);